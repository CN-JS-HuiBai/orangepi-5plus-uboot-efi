# SPDX-License-Identifier: GPL-2.0+
#
# (C) Copyright 2000 - 2013
# Wolfgang Denk, DENX Software Engineering, wd@denx.de.

Summary:
========
这里是OrangePi-3B的Uboot仓库，该uboot版本支持EFI启动，您可以直接使用bash build.sh快速构建镜像。
编译环境如下：

PRETTY_NAME="Ubuntu 22.04.3 LTS"
NAME="Ubuntu"
VERSION_ID="22.04"
VERSION="22.04.3 LTS (Jammy Jellyfish)"
VERSION_CODENAME=jammy
ID=ubuntu
ID_LIKE=debian
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
UBUNTU_CODENAME=jammy

附启动日志：
DDR Version V1.10 20210810
ln
ddrconfig:7
LPDDR4X, 324MHz
BW=32 Col=10 Bk=8 CS0 Row=16 CS1 Row=16 CS=2 Die BW=16 Size=4096MB
tdqss: cs0 dqs0: -96ps, dqs1: -217ps, dqs2: -120ps, dqs3: -192ps, 
tdqss: cs1 dqs0: -96ps, dqs1: -217ps, dqs2: -144ps, dqs3: -192ps, 

change to: 324MHz
PHY drv:clk:36,ca:36,DQ:29,odt:60
vrefinner:16%, vrefout:41%
dram drv:40,odt:0
clk skew:0x66

change to: 528MHz
PHY drv:clk:36,ca:36,DQ:29,odt:60
vrefinner:16%, vrefout:41%
dram drv:40,odt:0
clk skew:0x58

change to: 780MHz
PHY drv:clk:36,ca:36,DQ:29,odt:60
vrefinner:16%, vrefout:41%
dram drv:40,odt:0
clk skew:0x58

change to: 1056MHz(final freq)
PHY drv:clk:36,ca:36,DQ:29,odt:60
vrefinner:16%, vrefout:22%
dram drv:40,odt:80
vref_ca:00000071
clk skew:0x4d
cs 0:
the read training result:
DQS0:0x3e, DQS1:0x39, DQS2:0x41, DQS3:0x3c, 
min  : 0xc  0xb  0xd  0xc  0x1  0x3  0x5  0x5 , 0x4  0x5  0x2  0x1  0x8  0xd  0xf  0xf ,
       0x3  0x2 0x10  0xd  0xb  0xb  0xd  0xb , 0x5  0x4  0x8  0x1  0xd  0xc  0xd  0xb ,
mid  :0x2a 0x28 0x2a 0x29 0x1f 0x20 0x22 0x23 ,0x23 0x24 0x21 0x1f 0x26 0x2c 0x2c 0x2e ,
      0x22 0x21 0x2d 0x2b 0x29 0x29 0x2a 0x28 ,0x25 0x23 0x28 0x1f 0x2b 0x2a 0x2c 0x2a ,
max  :0x48 0x46 0x48 0x47 0x3d 0x3d 0x40 0x42 ,0x42 0x43 0x40 0x3d 0x45 0x4b 0x4a 0x4d ,
      0x41 0x40 0x4a 0x49 0x47 0x47 0x47 0x45 ,0x45 0x42 0x48 0x3e 0x49 0x49 0x4b 0x49 ,
range:0x3c 0x3b 0x3b 0x3b 0x3c 0x3a 0x3b 0x3d ,0x3e 0x3e 0x3e 0x3c 0x3d 0x3e 0x3b 0x3e ,
      0x3e 0x3e 0x3a 0x3c 0x3c 0x3c 0x3a 0x3a ,0x40 0x3e 0x40 0x3d 0x3c 0x3d 0x3e 0x3e ,
the write training result:
DQS0:0x41, DQS1:0x30, DQS2:0x3d, DQS3:0x34, 
min  :0x59 0x5b 0x5b 0x5d 0x52 0x52 0x54 0x58 0x58 ,0x48 0x49 0x46 0x45 0x4a 0x51 0x51 0x53 0x4e ,
      0x4d 0x4b 0x56 0x56 0x53 0x54 0x55 0x55 0x55 ,0x4a 0x4a 0x50 0x4a 0x52 0x52 0x54 0x54 0x4e ,
mid  :0x74 0x76 0x76 0x76 0x6d 0x6d 0x6f 0x73 0x72 ,0x65 0x66 0x61 0x60 0x67 0x6d 0x6d 0x70 0x6a ,
      0x68 0x67 0x72 0x72 0x6f 0x6f 0x6f 0x70 0x70 ,0x66 0x67 0x6a 0x65 0x6e 0x6e 0x6f 0x6f 0x69 ,
max  :0x8f 0x91 0x92 0x90 0x88 0x88 0x8b 0x8e 0x8d ,0x83 0x83 0x7d 0x7c 0x85 0x8a 0x8a 0x8d 0x87 ,
      0x84 0x84 0x8e 0x8e 0x8c 0x8a 0x8a 0x8b 0x8c ,0x83 0x84 0x85 0x81 0x8a 0x8a 0x8b 0x8a 0x85 ,
range:0x36 0x36 0x37 0x33 0x36 0x36 0x37 0x36 0x35 ,0x3b 0x3a 0x37 0x37 0x3b 0x39 0x39 0x3a 0x39 ,
      0x37 0x39 0x38 0x38 0x39 0x36 0x35 0x36 0x37 ,0x39 0x3a 0x35 0x37 0x38 0x38 0x37 0x36 0x37 ,
cs 1:
the read training result:
DQS0:0x3e, DQS1:0x3a, DQS2:0x40, DQS3:0x3b, 
min  : 0xd  0xb  0xf  0xc  0x1  0x3  0x5  0x6 , 0x5  0x6  0x2  0x1  0x9  0xd 0x10 0x10 ,
       0x3  0x0  0xf  0xb  0xb  0xb  0xd  0xb , 0x5  0x4  0x8  0x1  0xd  0xb  0xd  0xa ,
mid  :0x2a 0x28 0x2b 0x29 0x1e 0x20 0x22 0x23 ,0x24 0x25 0x21 0x1f 0x27 0x2c 0x2d 0x2f ,
      0x21 0x1e 0x2c 0x2a 0x28 0x28 0x29 0x28 ,0x23 0x22 0x27 0x1f 0x2a 0x29 0x2b 0x28 ,
max  :0x47 0x46 0x48 0x46 0x3c 0x3d 0x40 0x41 ,0x43 0x44 0x40 0x3d 0x46 0x4c 0x4b 0x4e ,
      0x3f 0x3c 0x49 0x49 0x46 0x46 0x45 0x45 ,0x42 0x41 0x46 0x3d 0x48 0x48 0x49 0x47 ,
range:0x3a 0x3b 0x39 0x3a 0x3b 0x3a 0x3b 0x3b ,0x3e 0x3e 0x3e 0x3c 0x3d 0x3f 0x3b 0x3e ,
      0x3c 0x3c 0x3a 0x3e 0x3b 0x3b 0x38 0x3a ,0x3d 0x3d 0x3e 0x3c 0x3b 0x3d 0x3c 0x3d ,
the write training result:
DQS0:0x41, DQS1:0x30, DQS2:0x3d, DQS3:0x34, 
min  :0x58 0x5b 0x5b 0x5c 0x52 0x53 0x55 0x58 0x58 ,0x49 0x4a 0x47 0x46 0x4d 0x52 0x52 0x55 0x4e ,
      0x4a 0x4a 0x54 0x55 0x51 0x52 0x53 0x53 0x52 ,0x4c 0x4c 0x51 0x4b 0x54 0x54 0x55 0x55 0x50 ,
mid  :0x74 0x76 0x76 0x76 0x6d 0x6d 0x70 0x73 0x72 ,0x64 0x66 0x62 0x61 0x68 0x6d 0x6e 0x70 0x6a ,
      0x65 0x65 0x6f 0x70 0x6c 0x6c 0x6d 0x6d 0x6e ,0x67 0x67 0x6b 0x65 0x6f 0x6f 0x70 0x70 0x6a ,
max  :0x91 0x91 0x92 0x91 0x88 0x88 0x8b 0x8f 0x8d ,0x80 0x82 0x7d 0x7c 0x84 0x88 0x8a 0x8c 0x87 ,
      0x80 0x80 0x8a 0x8b 0x88 0x86 0x87 0x87 0x8a ,0x83 0x82 0x85 0x80 0x8a 0x8a 0x8b 0x8b 0x84 ,
range:0x39 0x36 0x37 0x35 0x36 0x35 0x36 0x37 0x35 ,0x37 0x38 0x36 0x36 0x37 0x36 0x38 0x37 0x39 ,
      0x36 0x36 0x36 0x36 0x37 0x34 0x34 0x34 0x38 ,0x37 0x36 0x34 0x35 0x36 0x36 0x36 0x36 0x34 ,
CA Training result:
cs:0 min  :0x47 0x40 0x40 0x3b 0x40 0x39 0x41 ,0x48 0x40 0x43 0x3b 0x40 0x38 0x41 ,
cs:0 mid  :0x82 0x82 0x7c 0x7c 0x7b 0x7a 0x6e ,0x82 0x81 0x7e 0x7c 0x7c 0x7a 0x6d ,
cs:0 max  :0xbe 0xc4 0xb8 0xbe 0xb7 0xbc 0x9c ,0xbc 0xc3 0xb9 0xbd 0xb8 0xbc 0x9a ,
cs:0 range:0x77 0x84 0x78 0x83 0x77 0x83 0x5b ,0x74 0x83 0x76 0x82 0x78 0x84 0x59 ,
cs:1 min  :0x43 0x3f 0x3c 0x3b 0x3d 0x39 0x3d ,0x45 0x40 0x3f 0x3d 0x3c 0x39 0x3e ,
cs:1 mid  :0x81 0x80 0x7a 0x7b 0x7a 0x78 0x6c ,0x82 0x80 0x7c 0x7c 0x7a 0x78 0x6c ,
cs:1 max  :0xbf 0xc1 0xb8 0xbc 0xb8 0xb8 0x9b ,0xbf 0xc0 0xba 0xbb 0xb9 0xb8 0x9b ,
cs:1 range:0x7c 0x82 0x7c 0x81 0x7b 0x7f 0x5e ,0x7a 0x80 0x7b 0x7e 0x7d 0x7f 0x5d ,
out

U-Boot SPL 2023.10-OrangePi-3B (Dec 05 2023 - 21:14:40 +0800)
Trying to boot from SPI
## Checking hash(es) for config config-1 ... OK
## Checking hash(es) for Image atf-1 ... sha256+ OK
## Checking hash(es) for Image u-boot ... sha256+ OK
## Checking hash(es) for Image fdt-1 ... sha256+ OK
## Checking hash(es) for Image atf-2 ... sha256+ OK
## Checking hash(es) for Image atf-3 ... sha256+ OK
## Checking hash(es) for Image atf-4 ... sha256+ OK
## Checking hash(es) for Image atf-5 ... sha256+ OK
INFO:    Preloader serial: 2
NOTICE:  BL31: v2.3():v2.3-181-gc9a647cae:cl
NOTICE:  BL31: Built : 10:55:41, Oct 18 2021
INFO:    GICv3 without legacy support detected.
INFO:    ARM GICv3 driver initialized in EL3
INFO:    pmu v1 is valid
INFO:    dfs DDR fsp_param[0].freq_mhz= 1056MHz
INFO:    dfs DDR fsp_param[1].freq_mhz= 324MHz
INFO:    dfs DDR fsp_param[2].freq_mhz= 528MHz
INFO:    dfs DDR fsp_param[3].freq_mhz= 780MHz
INFO:    Using opteed sec cpu_context!
INFO:    boot cpu mask: 0
INFO:    BL31: Initializing runtime services
WARNING: No OPTEE provided by BL2 boot loader, Booting device without OPTEE initialization. SMC`s destined for OPTEE will return SMC_UNK
ERROR:   Error initializing runtime service opteed_fast
INFO:    BL31: Preparing for EL3 exit to normal world
INFO:    Entry point address = 0xa00000
INFO:    SPSR = 0x3c9


U-Boot 2023.10-OrangePi-3B (Dec 05 2023 - 21:14:40 +0800)

Model: Xunlong Orange Pi 3B
DRAM:  4 GiB (effective 3.7 GiB)
PMIC:  RK8090 (on=0x80, off=0x08)
Core:  338 devices, 32 uclasses, devicetree: separate
MMC:   mmc@fe2b0000: 1, mmc@fe2c0000: 2, mmc@fe310000: 0
Loading Environment from nowhere... OK
In:    serial@fe660000
Out:   serial@fe660000
Err:   serial@fe660000
Model: Xunlong Orange Pi 3B
Net:   eth0: ethernet@fe010000
Hit any key to stop autoboot:  0 
Card did not respond to voltage select! : -110
Card did not respond to voltage select! : -110
** Booting bootflow 'nvme#0.blk#1.bootdev.part_1' with efi
Card did not respond to voltage select! : -110
Card did not respond to voltage select! : -110
Card did not respond to voltage select! : -110
Booting /efi\boot\bootaa64.efi
System BootOrder not found.  Initializing defaults.

ethernet@fe010000 Waiting for PHY auto negotiation to complete....... done


                                            GRUB version 2.06

 ┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
 │ Red Hat Enterprise Linux (6.6.4-OPI3B-RK3566) 9.3 (Plow)                                                          │ 
 │*Red Hat Enterprise Linux (6.6.4-381.12.05.el9_3.aarch64) 9.3 (Plow)                                               │
 │ Red Hat Enterprise Linux (6.6.4-329.12.04.el9_3.aarch64) 9.3 (Plow)                                               │
 │ Red Hat Enterprise Linux (0-rescue-66159261c44d45a592f5d9aa83de195d) 9.2 (Plow)                                   │
 │ UEFI Firmware Settings                                                                                            │
 └───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

 Use the ▲ and ▼ keys to select which entry is highlighted.                                                                                                                     
 Press enter to boot the selected OS, `e' to edit the commands before booting or `c' for a command-line. ESC to retur
 n previous menu.                                           
                                                                                                                                                                                          
                                                                                                                                                                                          

EFI stub: Booting Linux Kernel...
EFI stub: Using DTB from configuration table
EFI stub: Exiting boot services...
